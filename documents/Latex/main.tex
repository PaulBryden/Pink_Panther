\documentclass[conference]{IEEEtran}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{changepage}
\usepackage{graphicx}
\usepackage{float}
\usepackage{amssymb}
\usepackage{array}
\usepackage[english]{babel}
\title{Open Source Software Framework for Indoor Geolocation Using 802.11 Protocol}
\author{Authors Name }
\date{April 2018}
\usepackage[backend=bibtex,style=numeric]{biblatex}
\bibliography{main.bib} 
\begin{document}
\maketitle
\begin{abstract}
	1 in 4 Americans over the age of 65 fall every year. [1] Most of these falls are very serious and can result in major mobility injuries and/or death. The shorter the amount of time it takes for fall victims to get medical attention, the higher their odds of recovery are. As such, it would be very beneficial to develop an Open Source Software Framework capable of identifying the location of a victim within a building or indoor environment using existing infrastructure. 
\newline This paper discusses the development of a platform-agnostic Open Source Software Framework capable of deriving the location of an individual down to ~3m accuracy using 802.11 WiFi protocol (in areas of good WiFi coverage). A complete end to end framework has been sketched and comprises of the Sensor Software (Embedded Layer), Web Services and Mobile Application for monitoring the movements of individuals. The location is calculated using a derived theory of trilateration and Kalman Filtering is employed to reduce the effect of multipath interference. The Software Framework is written mostly in C++ 11 and takes full advantage of modern design principles to ensure platform portability and flexibility. The sketched solution provides a real, affordable, extendible solution to the problem out laid and it is hoped that thousands of individuals may benefit from it's application in the field.
\end{abstract}
\section{Introduction}
According to the Centers for Medicare and Medicaid Services, health-care in the United States has seen a tremendous growth in past decade. It projects 5.9\% growth increase in 2018 and projects to see 19.9\% National Health spending as a share of GDP. The maximum percentage of this is needed by people above the age of 55 which comprise approximately 29\% of the population in America \cite{hi}. The primary reasons for injuries in elderly people are falls due to their debility with respect to their age. Some of these injuries can be fatal or may create a psyche of fear in the individual resulting in them losing the ability to walk properly after the fall. Many algorithms and embedded technologies have been in research and development for the past several years which aim to work towards the basic goal of detecting a fall and reporting the location of the fallen individual to the respective authority.
\newline Indoor geolocation tracking is an evolving technology which helps to get an accurate location of a person indoors. One of the promising classes of this emerging technology is to take advantage of the existing infrastructure to determine the location \cite{pahlavan2002indoor}. Much work has been carried out to use GPS for Indoor location tracking \cite{kjaergaard2010indoor}. However, the GPS has only 50 \% precision within 7.3 m range in Indoor Geolocation tracking \cite{liu2007survey}. In addition, GPS does not derive an altitude for the user's location which prevents floor-level determination from taking place. 
\newline This paper sketches the development of an Open Source Software Platform capable of tracking the movements of individuals using existing 802.11 WiFi(R) Infrastructure. The modularity of the Software Framework developed, and it's strong use of C++11 Design Principles, also enables it to be easily adapted to a variety of hardware platforms and radio technologies such as Bluetooth or LoraWAN.
\section{Background}
\noindent As was mentioned, the ability to identify the geographic location of an individual residing outside of a building by latitude, longitude, and altitude is easily accomplished using a relatively inexpensive GPS receiver. Typical commercially available receivers for under \$100 can provide coordinates within a sampling time of the 30s to an accuracy of \newcommand{\rpm}{\raisebox{.2ex}{$\scriptstyle\pm$}} 3m. For example, the Copernicus II 12-channel GPS module from Trimble is under \$70 and can provide updated coordinates with a period of 3s. GPS receivers typically use a carrier wave in the L1 band at 1575.42 MHz on which navigation messages are modulated. Unfortunately, such microwave signals are significantly attenuated by building roofs and walls, rendering GPS unusable indoors. [2]
The indoor position measurements can be accomplished using different mechanisms such as radio signals, magnetic fields, and sound waves. Newer, emerging technologies employ computer vision to identify objects in the field of a camera's view. The vision system can then measure distances in between recognized objects, and between the user and recognized objects. These measurements provide a system with depth perception and can identify how far a user is away from a surface or other rigid body in a field of view.
This research project utilizes radio signals, specifically radio signals from 802.11 Wi-fi Access Points. After calculating the known location of these Access Points and the signal strength at the receiver, the distance can be derived using a modification of the free space equation. In this proposal, four access points are employed to derive the location of the user by calculating the distance between them using the trilateration principles.
\section{Software Framework Architecture}
The Software Framework which has been developed to solve the outlined problem can be broken down into 3 components:
\newline
1) Embedded Layer
\newline
2) Middleware Layer
\newline
3) Mobile Application Layer
\newline
The Embedded Layer comprises all of the software which runs on the sensor node attached to the user.
\newline
The MiddleWare Layer comprises all of the RESTful Web Services and the PostgreSQL database which connects the Embedded and Mobile Application layers and ultimately drives the solution.
\newline
The Mobile Application Layer consists of the Android Application which is used to render the derived user locations.
\newline
A diagram of the complete software framework can be seen in Figure 1.
\begin{figure}[H]
    \includegraphics[width=9 cm,height=5.5 cm]{2018-05-10-PHOTO-00000077.jpg}
    \caption{Software Framework Architecture Overview}
    \end{figure}
As was mentioned previously, the RESTful API is the fundamental interface between all components of the software framework. In terms of data flow, the web services provide the relative coordinates of known access points to the sensor node and the node responds with the relative X, Y, Z coordinates of its own derived location. The web services then translate these coordinates into absolute latitude, longitude, and altitude which are consumed by the web application.
\newline
\newline
These respective layers and their operation will now be discussed in detail.
\subsection{Embedded Layer}
The Embedded Layer is the component of the software framework which runs on the sensory device operated or worn by the user. The Embedded Layer was written entirely in C++ using C++11 design principles and is portable across Linux, Windows, IOS, Android and more platforms. This is possible thanks to the use of modern OOP design principles and the employment of such cross-platform libraries as BOOST and CPPRestSDK which remove the requirement of platform awareness for the majority of the system. As one can see from Figure 2, the only part of the system that requires awareness of the underlying OS/Platform is the Node Scanner Module. A Node in the framework is defined as any 802.11 Access Point. Direct OS interaction is required at this layer due to the low level of access required to the Wireless Hardware.
Boost is used mainly to enable straightforward, cross-platform, thread safety and thread handling and the CPPRestSDK are used to handle all JSON construction and parsing along with all HTTP Requests.
\begin{figure}[H]
    \includegraphics[width=9 cm,height=3.5 cm]{Pink_Panther_Architecture.png}
    \caption{Embedded Layer Architecture}
    \end{figure}

\subsubsection{Modules Overview}
Node Reader Module:
\newline
The Node Reader Module is responsible for creating a known list of nodes and their location.  This has been implemented in 2 different flavors - a file reader, and a HTTP GET reader. The recommended module to utilize is the HTTP GET reader. This module simply grabs the know list of nodes in JSON format from the middleware web services and populates a list of nodes known to the Location and REST Modules.
\newline
\newline
Node Scanner Module:
\newline
The Node Scanner Module is responsible for interfacing with the OS or Platform API which provides the data from a WiFi Scan - or other radio platform. It provides a list of Nodes populated with RSSI (Received Signal Strength).
\newline
\newline
Location Derivation Module:
\newline
The Location Derivation Module is responsible for deriving the exact X,Y and Z co-ordinates of the user node, based on the data from the Node Reader and Node Scanner Modules. The details of the implementation will be discussed in the theory of trilateration and implementation sections.
\newline
\newline
REST Module:
\newline
The REST Module is responsible for posting the data from the Location Derivation Module to the web services. It is also responsible for providing the data to any interested party through a GET route.
\newline
\subsubsection{Theory of Trilateration}
In order to derive the relative location of a particular sensor node, trilateration techniques will be employed. The theory and derivation of the particular techniques employed will be discussed and the effectiveness of the solution documented. Fundamentally, the ability to derive the location of the sensor node comes from the ability to measure  the  Received  Signal  Strength (RSS) of  several  different  Wi-Fi  access  points (APs)  within  32m  of  the  user.    Typically,  the  received  signal  power  within  one  meter  of  an  AP  will  be  approximately  -32  dBm,  and  close  to  -90  dBm  at  a  distance  of  32m. The RSS can be  modeled using  equation  (1)  
\begin{equation}
RSS = 10N*\log_{10}D-A  
\end{equation}
where: 
\newline
N = Signal propagation constant
\newline
A = Received signal strength at 1 meter (dBm)
\newline
D = Distance in (m)
\newline
\newline
The optimal signal propagation constant for a noisy indoor environment was found to be approximately 2.5. With  4 or more  Access Points,  one  can  use  trilateration  to  locate  a  user  using  four  distances  computed  from  four  RSS  values.    Let  ( x , y , z )  represent  the  unknown  location  of  a  user  and $(d_1,  d_2,  d_3,  d_4)$ represent 4 distance values obtained from the measured RSS between user's Embedded Wireless Device and Four Access Points. The System of Euclidian  distances  between  the  user  and  four  Access Points  is  given  by  equations below:

\begin{equation}
x-x_1^2 + y-y_1^2 + z-z_1^2 =d_1^2
\end{equation}
\begin{equation}
 x-x_2^2 + y-y_2^2 + z-z_2^2 =d_2^2 
\end{equation}
\begin{equation}
 x-x_3^2 + y-y_3^2 + z-z_3^2 =d_3^2 
\end{equation}
\begin{equation}
 x-x_4^2 + y-y_4^2 + z-z_4^2=d_4^2 
 \end{equation}
 \newline Subtracting rows 2, 3 and 4 from row 1, the following set of equations can be derived.
\begin{equation}
\resizebox{0.9\hsize}{!}{$2(x_2 - x_1) + 2(y_2 - y_1)y + 2 (z_2 - z_1)z = x_2^2 - x_1^2  + y_2^2 - y_1^2 + z_2^2 - z_1^2 - d_2^2 +d_1^2$}
\end{equation}
\begin{equation}
\resizebox{0.9\hsize}{!}{$2(x_3 - x_1) + 2(y_3 - y_1)y + 2 (z_3 - z_1)z = x_3^2 - x_1^2 + y_3^2 - y_1^2 + z_3^2 - z_1^2 - d_3^2 +d_1^2$}
\end{equation}
\begin{equation}
\resizebox{0.9\hsize}{!}{$2(x_4 - x_1) + 2(y_4 - y_1)y + 2 (z_4 - z_1)z = x_4^2 - x_1^2 + y_4^2 - y_4^2 + z_4^2 - z_1^2 - d_4^2 +d_1^2$}
\end{equation}
The System can be expressed in Ax=b matrix form as
 \newline
 \\* 
 
\begin{equation}
\resizebox{0.9\hsize}{!}{
$\left[ \begin{array}{ccc}
(x_2 - x_1) & (y_2 - y_1) & (z_2 - z_1)\\
(x_3 - x_1) & (y_3 - y_1) & (z_3 - z_1) \\
(x_4 - x_1) & (y_4 - y_1) & (z_4 - z_1) \\
\end{array} \right] 
% 
\left[ \begin{array}{c}
x \\
y\\
z\\
\end{array} \right]
%
= 1/2 
\left[ \begin{array}{c}
x_2^2 - x_1^2 + y_2^2 - y_1^2 + z_2^2 - z_1^2 - d_2^2 + d_1^2 \\
x_3^2 - x_1^2 + y_3^2 - y_1^2 + z_3^2 - z_1^2 - d_3^2 + d_1^2 \\
x_4^2 - x_1^2 + y_4^2 - y_1^2 + z_4^2 - z_1^2 - d_4^2 + d_1^2 \\
\end{array} \right]
$}
\end{equation}
\\*
\newline and solved using a Gauss - Newton least squares approximation. 
\begin{equation}
(A^TA)X = A^Tb
\end{equation}
\newline
Since A is constant, the system of equations can also be solved by simply using back substitution or least uppers squares estimate.
\newline
However, multipath  effects,  co-channel  interference  (CCI), and  adjacent-channel  interference can  affect  the  SNR,  resulting  in  location  measurement  error. In an attempt to mediate the error introduced by such environmental effects, Kalman Filtering will be employed.
\newline
\subsubsection{Theory of Extended Kalman Filter}
RSS (Received Signal Strength) value depends directly, and only, on the distance between the 802.11 Wi-Fi transmitter and the receiver – in an ideal system. In reality, however, multipath interference, Electromagnetic interference and signal fading all play a significant role in causing fluctuations in the Received Signal Strength. As such, it is required that the RSS values are filtered in the time domain such as to mitigate the effect of such noise. One such method is through the use of an extended Kalman Filter. The equations representing the implemented Kalman filter can be seen below and are executed on each "tick" of the system.
\begin{equation}
p = p + q
\end{equation}
\begin{equation}
k = p / (p + r)
\end{equation}
\begin{equation}
x = x + k * (i - x)
\end{equation}
\begin{equation}
p = (1 - k) * p
\end{equation}
where:
\newline
q is the Process Noise Covariance \\
r  is the Measurement Noise Covariance \\
x is the Kalman Filtered Value \\
p is the Estimation Error Covariance \\
k is the Kalman Gain \\
i is the most recently measured RSSI value\\

\noindent Measurement Covariance is the standard deviation of a set of measured results – determined to be 2.36dBm This was derived by taking several measurements of the RSSI (dBm) at a 1m distance from an 802.11 Wireless Access Point in the test environment. The Process Covariance is the susceptibility of the system to change - determined to be 0.001. This was determined through trials to best match the typical speed at which an individual may move around a facility.
\newline
\subsubsection{Implementation}
The Embedded Layer was implemented in a very modular fashion using OOP and C++11 design principles. These include but are not limited to Polymorphism, Inheritance, Decorator and Singleton patterns. Such modern C++ features as Shared Pointers, Scoped Locks, Tasks and Initializer Lists were also heavily utilized.
The employment of these principles and features has enabled a very flexible, thread-safe, memory safe system to be constructed and portable across multiple platforms. The UML for the completed system can be seen in Figure 3.

\begin{figure}[H]
    \includegraphics[width=9cm,height= 9 cm]{uml_9-5-18.png}
    \caption{UML Diagram of Embedded Layer}
    \end{figure}

The system comprises 2 core components:
\newline
Module Classes: These are the core drivers of the system. Each module provides the system with discrete functionality. Some modules, such as the Rest Module, rely on other modules to enable operation, however, they do not depend on a particular implementation of those modules. \newline
There are 4 key modules which make up this system:
\newline
The Location Module Class - This module is responsible for deriving the exact location of the user based on the 4 Nodes with the best signal strength in the target node container. In this Open Source Framework, the LAPACK mathematical library is used to solve the systems of equations. 3 different methodologies for location derivation are employed; DGESV and DGELS for least squares approximation and DGETRS for back substition.
\newline
The Rest Module Class - This module is responsible for providing the location, scan and target node list data to any interested parties by hosting the JSON on a GET Route. The module is also responsible for POSTing the derived location data to the remote web services server.
\newline
The Scan Module Class - This module is responsible for populating a list of nodes with the RSSI evident at the Beaglebone for each Access Point. This list can then be used to update the target nodes.
\newline
The Node Reader Module Class - This module is responsible for populating a list of "Target" Nodes. That is, nodes which are of known location. This list can be obtained from a file in JSON format, using the filereader variant or from a web address using the GETreader variant.
\newline
 
Data Classes: These are the classes which all modules use to some extent. The "Data" classes are the Node, Node Container and Location Classes which store information relating to AP information or User location information. Node class objects are used to identify any Node picked up in a Scan. Target Nodes correspond to nodes of which the location is known and as such can be used for triangulation. Each Target Node is responsible for updating it's Kalman Filtered Location when a new RSSI value is provided. The location data class simply contains the X, Y and Z coordinates for a location and helper methods for accessing and modifying this data. 
\newline
The system is driven by the Main Class, where all of the modules are created and initialized. The main loop ensures the system is continuously scanning and updating the location as quickly as possible. A target node container is created and shared between the location module, node reader module and Scan Module. When the modules are initialized, the Node Reader Module updates that container with a list of target nodes, of known location, which is updated with RSSI measurements as is necessary through the Scan Module. The Location Module then employs this information to derive relevant, up to date location information. This information is then POSTed by the REST Module to the relevant web server and is also provided to anyone listener through a GET Route.

\subsection{Middleware}
The Middleware comprises of 2 main components:\newline
The RESTful Web Services and the Back-end Database. The Restful Web Services provide the API which both the Mobile Application and the Embedded Layer interact with.
The Back End Database is where all Location data related to known Access Points and User location is contained/amended. It is only interfaced with through the RESTful Web Services.
\newline
\subsubsection{RESTful Web Services}
The RESTful (Representational State Transfer) style web services were built using the JAVA Glassfish library and framework. The services basically provide an interface to the data contained within the database - as well as a way to write derived location data to the database. 2 GET Routes were provided:\newline
1) A route which lists the known access points for a location in JSON format \newline
2) A route which lists the user's exact location (longitude, latitude, and altitude).
\newline
There is also 1 HTTP POST route which takes in x, y, z co-ordinates and a site number (in JSON format) derived by the embedded layer and writes the corresponding Latitude, Longitude and Altitude into the PostgreSQL database.
\newline
\subsubsection{Back end Database}
PostgreSQL is the back end database where all the values that are pulled by the web-services including the exact location of the person are stored securely. The database consists of several tables including one pertaining information on known access point location and a moving window table containing last known location of the sensor nodes. The location of access points for Montezuma Hall and the Engineering Building and the Student Union 2nd floor can be determined by using AutoCAD.In order to obtain coordinates of each access points a common origin was placed in the southwest corner of each building, than the correct latitude and longitude of each access point was obtained by offsetting the latitude and longitude of the origin. Cartesian coordinates relative to the corner of the location are stored in the database.
\newline

\section{Mobile Android Application}
 The Mobile Android Application was developed as a proof of concept to show the power of the developed system. The application simply GETs the relevant Long/Lat coordinates from the web services and renders them as a point using the Google Maps API. In addition, the architectural plans for the building being targeted are also rendered on the Google Map to enable individual rooms to be easily identified. The application was published on the App Store and it is possible for multiple individuals on different Android devices to utilize the application simultaneously. The application can be seen in Figure 4.
\begin{figure}[H]
    \includegraphics[width=8cm,height=5cm]{2018-05-10-PHOTO-00000078.png}
    \caption{Mobile Android Application Using Google Maps API}
    \end{figure}
\section{Testing and Results}
\subsection{Test Platform}
As one can see, a modular, flexible, portable, end to end, Open Source Framework has been developed, capable of deriving the location of a user using existing WiFi infrastructure. However, the accuracy of the system has not been discussed. In order to test the system, an embedded ARM Linux board called the Beaglebone was employed with a WiLink 8 chip. 2x 6dB, vertically polarized, high gain Antennae were employed to boost the RSSI (Received Signal Strength Indicator) present at the Wilink Chip. The solution was powered by a 2000mAh battery and was contained within a 3D printed housing. The solution can be seen in Figure 5.
\begin{figure}[H]
    \includegraphics[width=8cm,height=5cm]{IMG_0796.JPG}
    \caption{Beaglebone Test Platform}
    \end{figure}

\subsection{Results}
In order to validate the effectiveness of the solution - multiple tests were completed to evaluate:\newline
i) The Kalman Filter \newline
ii) The execution time of the LAPACK functions\newline
iii) The effectiveness of the location complete derivation toolkit.

\subsubsection{Kalman Filter Results}
The Kalman Filter, and it's performance, was
\begin{figure}[H]
    \includegraphics[width=8cm,height=5cm]{2018-05-10-PHOTO-00000079.png}
    \caption{Kalman Results}
    \end{figure}
\subsubsection{LAPACK Results}
18000 ns DGELS
10000 ns DGESV
6000 ns DGETRS
\subsubsection{Location Results}
The system was tested in a relatively "noisy" engineering environment with electromagnetic interference and large multipath losses. The 3rd floor of the SDSU Engineering Building was the chosen environment. The test platform was found to have a scan refresh rate of around 2 Hz. There was also a settle time of ~ 10 seconds for the Kalman Filter. However, an error of approximately 3m was evident in areas of good Wireless Coverage (Less than 10m to each AP) such as in Figure 6.
\begin{figure}[H]
    \includegraphics[width=9.0cm,height=6cm]{Geolocation_1.jpeg}
    \caption{Kalman Results}
    \end{figure}


In areas of poorer coverage, an error of approximately 10m was present. Poorer coverage is designated as any situation where there it is more than 15m to 2 or more APs, or in areas of high interference and/or path loss. (See Figure 7)
\begin{figure}[H]
    \includegraphics[width=9.0cm,height=6cm]{Geolocation_2.jpeg}
    \caption{Kalman Results}
    \end{figure}

However, there is a key limitation of the system and that is its inability to differentiate between signal attenuation due to distance and signal attenuation due to obstacle-induced path loss. This means that the system may derive the location of the individual to be in the left corner of the map, outside the building boundaries instead of their actual location as shown in Figure 8.
\begin{figure}[H]
    \includegraphics[width=9.0cm,height=6cm]{Geolocation_3.jpeg}
    \caption{Kalman Results}
    \end{figure}

\section{Further Work}
As one can see, the developed system is fully capabale of deriving the location of a user, given 4 or more known access points within range. However, a number of areas continue to beacon as avenues of future work. Firstly, the employment of Machine Learning, and by taking many 1000s of discrete measurements at various points around a building, it could be possible to tune the system to achieve much better location derivation results.  Furthermore, the mobile application and Web services developed in this paper was a base that might require expansion  to support multiple clients and could provide other information regarding the location of the person. The edge of this project is that it can be implemented on platforms by developing different Scan Module implementations Also various profiling of the system with different devices and antennae configurations can be done.

\section{Conclusion}
This paper has presented an Open Source Software framework capable of determining the exact location of a person indoors using derived trilateration theory. This design is implemented using the trilateration techniques by determining coordinates of existing access points of a location. The mobile application helps us to determine that more promising results are accomplished using this mechanism rather than using GPS. 
\newline Implementation of this design is very economical as it can be developed without making major changes and this makes this technology more user-friendly. Our design is currently been implemented using Wifi 802.11. We offer an approach to be used by other people to develop this technology on other platforms. [TO BE REVISED]
\printbibliography

\end{document}
